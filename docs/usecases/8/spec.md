# UC-008: 인플루언서 정보 등록

## 1. 유스케이스 정보

| 항목 | 내용 |
|------|------|
| **유스케이스 ID** | UC-008 |
| **유스케이스 이름** | 인플루언서 정보 등록 |
| **액터** | 로그인된 사용자 (역할 미등록) |
| **우선순위** | 높음 |
| **관련 기능** | 사용자 정보 관리 |

## 2. 사전조건 (Preconditions)

- 사용자가 로그인 상태
- User.role이 NULL (역할 미등록 상태)
- 인플루언서 정보가 등록되지 않음

## 3. 사후조건 (Postconditions)

### 성공 시
- User 테이블 업데이트 (이름, 생년월일, 휴대폰번호)
- Influencer 테이블에 레코드 생성
- User.role이 'influencer'로 업데이트
- 세션에 역할 정보 저장
- 홈(체험단 탐색) 페이지로 리다이렉트

### 실패 시
- 에러 메시지 표시
- 인플루언서 정보 등록 페이지 유지

## 4. 주요 플로우 (Main Flow)

1. 사용자가 인플루언서 정보 등록 페이지(`/influencer/register`)에 접속
2. 다음 정보 입력:
   - **공통**: 이름, 생년월일 (YYYY-MM-DD), 휴대폰번호 (010-XXXX-XXXX)
   - **인플루언서 전용**: SNS 채널명, 채널링크 (URL), 팔로워수 (숫자)
3. "등록" 버튼 클릭
4. **시스템**: 로그인 여부 검증
5. **시스템**: 중복 등록 검증
   - Influencer 테이블에서 user_id로 레코드 조회
   - 이미 등록된 경우: "이미 인플루언서 정보가 등록되어 있습니다" + 홈으로 리다이렉트
6. **시스템**: 입력 검증
   - 이름: 2자 이상, 한글/영문만
   - 생년월일: YYYY-MM-DD 형식, 만 14세 이상
   - 휴대폰번호: 010-XXXX-XXXX 형식, 중복 여부 확인
   - SNS 채널명: 2자 이상
   - 채널링크: URL 형식 검증 (http:// 또는 https://)
   - 팔로워수: 0 이상의 정수
7. **시스템**: 트랜잭션 시작
8. **시스템**: User 테이블 업데이트
   - name, birth_date, phone_number 업데이트
   - role을 'influencer'로 업데이트
9. **시스템**: Influencer 테이블에 레코드 생성
   - user_id, channel_name, channel_url, follower_count 저장
10. **시스템**: 트랜잭션 커밋
11. **시스템**: 세션에 역할 정보 저장 (role: 'influencer')
12. **시스템**: 홈(체험단 탐색) 페이지(`/`)로 리다이렉트
13. **시스템**: "인플루언서 정보가 등록되었습니다" 메시지 표시

## 5. 대체 플로우 (Alternative Flows)

### 5.1 미로그인 상태
- **시점**: 4단계 (로그인 검증)
- **조건**: 세션에 user_id 없음
- **처리**:
  - 로그인 페이지로 리다이렉트

### 5.2 이미 인플루언서 정보 등록됨
- **시점**: 5단계 (중복 등록 검증)
- **조건**: Influencer 테이블에 user_id로 레코드 존재
- **처리**:
  - "이미 인플루언서 정보가 등록되어 있습니다" 메시지 표시
  - 홈으로 리다이렉트

### 5.3 입력 검증 실패
- **시점**: 6단계 (입력 검증)
- **조건**: 각 필드별 검증 실패
- **처리**:
  - 구체적인 에러 메시지 표시
  - 해당 입력 필드 하이라이트
  - 플로우 중단

### 5.4 채널링크 중복
- **시점**: 6단계 (입력 검증)
- **조건**: 동일한 채널링크가 이미 존재
- **처리**:
  - "이미 등록된 채널링크입니다" 메시지 표시
  - 플로우 중단

### 5.5 휴대폰번호 중복
- **시점**: 6단계 (입력 검증)
- **조건**: 동일한 휴대폰번호가 이미 존재
- **처리**:
  - "이미 사용 중인 휴대폰번호입니다" 메시지 표시
  - 플로우 중단

## 6. 예외 플로우 (Exception Flows)

### 6.1 트랜잭션 롤백
- **조건**: User 업데이트 또는 Influencer 생성 실패
- **처리**:
  - 트랜잭션 롤백
  - "일시적인 오류가 발생했습니다. 다시 시도해주세요" 메시지 표시
  - 플로우 중단

### 6.2 DB 저장 실패
- **조건**: 데이터베이스 연결 오류 또는 제약조건 위반
- **처리**:
  - "일시적인 오류가 발생했습니다. 다시 시도해주세요" 메시지 표시
  - 플로우 중단

## 7. 비즈니스 규칙 (Business Rules)

### BR-001: 채널링크 중복 검증
- 동일한 채널링크는 중복 등록 방지
- 애플리케이션 레벨에서 검증 (UNIQUE 제약조건 없음)

### BR-002: 만 14세 이상만 인플루언서 가능
- 생년월일 기준 만 14세 미만은 인플루언서 등록 불가
- 애플리케이션 레벨에서 검증

### BR-003: User와 Influencer 1:1 관계
- 한 User는 하나의 Influencer 레코드만 가질 수 있음
- Influencer.user_id UNIQUE 제약조건

### BR-004: 트랜잭션 원자성
- User 업데이트와 Influencer 생성은 트랜잭션으로 묶어 원자성 보장
- 하나라도 실패 시 전체 롤백

### BR-005: 팔로워수 0 이상
- 팔로워수는 0 이상의 정수여야 함
- Influencer.follower_count CHECK 제약조건

## 8. UI/UX 요구사항

### 입력 필드
- 이름: 텍스트 입력
- 생년월일: 날짜 선택기 (YYYY-MM-DD)
- 휴대폰번호: 텍스트 입력 (010-XXXX-XXXX)
- SNS 채널명: 텍스트 입력
- 채널링크: URL 입력
- 팔로워수: 숫자 입력

### 버튼
- "등록" 버튼 (Primary)

### 메시지
- 성공: "인플루언서 정보가 등록되었습니다"
- 에러: 각 검증 실패 시 구체적인 메시지 표시

## 9. 데이터 모델

### 입력 데이터
```json
{
  "name": "이인플루",
  "birth_date": "1995-08-20",
  "phone_number": "010-9876-5432",
  "channel_name": "뷰티 채널",
  "channel_url": "https://www.youtube.com/@beauty",
  "follower_count": 50000
}
```

### 출력 데이터 (성공 시)
```json
{
  "user_id": "uuid-v4",
  "influencer_id": 1,
  "role": "influencer"
}
```

## 10. 시퀀스 다이어그램

```
사용자 -> 인플루언서 정보 등록 페이지: 접속
인플루언서 정보 등록 페이지 -> 사용자: 입력 폼 표시
사용자 -> 인플루언서 정보 등록 페이지: 정보 입력 및 제출
인플루언서 정보 등록 페이지 -> AuthService: 로그인 검증
AuthService --> 인플루언서 정보 등록 페이지: 검증 성공
인플루언서 정보 등록 페이지 -> DB (Influencer): 중복 등록 검증
DB (Influencer) --> 인플루언서 정보 등록 페이지: 중복 없음
인플루언서 정보 등록 페이지 -> WTForms: 입력 검증
WTForms --> 인플루언서 정보 등록 페이지: 검증 성공
인플루언서 정보 등록 페이지 -> DB: 트랜잭션 시작
인플루언서 정보 등록 페이지 -> DB (User): User 업데이트
DB (User) --> 인플루언서 정보 등록 페이지: 업데이트 완료
인플루언서 정보 등록 페이지 -> DB (Influencer): Influencer 생성
DB (Influencer) --> 인플루언서 정보 등록 페이지: 생성 완료
인플루언서 정보 등록 페이지 -> DB: 트랜잭션 커밋
DB --> 인플루언서 정보 등록 페이지: 커밋 완료
인플루언서 정보 등록 페이지 -> Flask Session: 역할 저장
Flask Session --> 인플루언서 정보 등록 페이지: 저장 완료
인플루언서 정보 등록 페이지 -> 사용자: 홈으로 리다이렉트
```

## 11. 테스트 시나리오

### 11.1 정상 등록
- **Given**: 로그인된 사용자 (역할 미등록)
- **When**: 모든 필드를 올바르게 입력하고 제출
- **Then**: User/Influencer 테이블 업데이트, 홈으로 이동

### 11.2 채널링크 중복
- **Given**: 이미 등록된 채널링크 존재
- **When**: 동일한 채널링크로 등록 시도
- **Then**: "이미 등록된 채널링크입니다" 에러 메시지 표시

### 11.3 만 14세 미만
- **Given**: 생년월일이 만 14세 미만
- **When**: 인플루언서 정보 등록 시도
- **Then**: "만 14세 이상만 인플루언서로 등록할 수 있습니다" 에러 메시지 표시

### 11.4 중복 등록 시도
- **Given**: 이미 인플루언서 정보가 등록된 사용자
- **When**: 인플루언서 정보 등록 페이지 접근
- **Then**: "이미 인플루언서 정보가 등록되어 있습니다" 메시지, 홈으로 리다이렉트

### 11.5 잘못된 URL 형식
- **Given**: 로그인된 사용자
- **When**: 채널링크에 URL 형식이 아닌 값 입력
- **Then**: "올바른 URL 형식을 입력해주세요" 에러 메시지 표시

## 12. 참고 문서

- `docs/userflow.md`: 인플루언서 정보 등록 플로우 (3)
- `docs/prd.md`: 인플루언서 정보 등록 기능 요구사항 (6.2.2)
- `docs/database.md`: Influencer 테이블 스키마 (3.3)
