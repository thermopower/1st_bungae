# UC-001: 회원가입

## 1. 유스케이스 정보

| 항목 | 내용 |
|------|------|
| **유스케이스 ID** | UC-001 |
| **유스케이스 이름** | 회원가입 |
| **액터** | 비로그인 사용자 |
| **우선순위** | 높음 |
| **관련 기능** | 인증 |

## 2. 사전조건 (Preconditions)

- 사용자가 아직 계정을 보유하지 않음
- 회원가입 페이지에 접근 가능

## 3. 사후조건 (Postconditions)

### 성공 시
- User 테이블에 새 레코드 생성 (user_id, email)
- Supabase Auth에 사용자 계정 생성
- 세션 생성 (액세스 토큰, 리프레시 토큰)
- 역할 선택 페이지로 리다이렉트

### 실패 시
- 에러 메시지 표시
- 회원가입 페이지 유지

## 4. 주요 플로우 (Main Flow)

1. 사용자가 회원가입 페이지(`/auth/register`)에 접속
2. 이메일 주소 입력
3. 비밀번호 입력
4. 비밀번호 확인 입력
5. "회원가입" 버튼 클릭
6. **시스템**: 입력 검증 수행
   - 이메일 형식 검증 (정규식)
   - 비밀번호 강도 검증 (최소 8자, 영문/숫자 포함)
   - 비밀번호 확인 일치 여부 검증
7. **시스템**: Supabase Auth API 호출 (회원가입 요청)
8. **시스템**: Supabase 응답 처리
   - 성공 (201 Created):
     - User 테이블에 레코드 생성
     - 세션 생성
9. **시스템**: 역할 선택 페이지(`/role-selection`)로 리다이렉트

## 5. 대체 플로우 (Alternative Flows)

### 5.1 이메일 형식 오류
- **시점**: 6단계 (입력 검증)
- **조건**: 이메일 형식이 올바르지 않음
- **처리**:
  - "올바른 이메일 형식을 입력해주세요" 메시지 표시
  - 이메일 입력 필드 하이라이트
  - 플로우 중단

### 5.2 비밀번호 강도 미달
- **시점**: 6단계 (입력 검증)
- **조건**: 비밀번호가 최소 8자 미만이거나 영문/숫자를 포함하지 않음
- **처리**:
  - "비밀번호는 최소 8자 이상, 영문과 숫자를 포함해야 합니다" 메시지 표시
  - 비밀번호 입력 필드 하이라이트
  - 플로우 중단

### 5.3 비밀번호 확인 불일치
- **시점**: 6단계 (입력 검증)
- **조건**: 비밀번호와 비밀번호 확인이 일치하지 않음
- **처리**:
  - "비밀번호가 일치하지 않습니다" 메시지 표시
  - 비밀번호 확인 입력 필드 하이라이트
  - 플로우 중단

### 5.4 이메일 중복
- **시점**: 8단계 (Supabase 응답 처리)
- **조건**: 이미 등록된 이메일
- **처리**:
  - "이미 사용 중인 이메일입니다" 메시지 표시
  - 플로우 중단

## 6. 예외 플로우 (Exception Flows)

### 6.1 네트워크 오류
- **조건**: Supabase Auth API 호출 시 네트워크 연결 실패
- **처리**:
  - "네트워크 연결을 확인해주세요" 메시지 표시
  - 플로우 중단

### 6.2 Supabase 서비스 다운
- **조건**: Supabase 서비스가 응답하지 않음
- **처리**:
  - "일시적인 오류가 발생했습니다. 잠시 후 다시 시도해주세요" 메시지 표시
  - 플로우 중단

### 6.3 DB 저장 실패
- **조건**: User 테이블 레코드 생성 실패
- **처리**:
  - "일시적인 오류가 발생했습니다. 다시 시도해주세요" 메시지 표시
  - 플로우 중단

## 7. 비즈니스 규칙 (Business Rules)

### BR-001: 이메일 중복 불가
- 동일한 이메일로 여러 계정을 생성할 수 없음
- Supabase Auth 레벨에서 강제

### BR-002: 비밀번호 강도
- 최소 8자 이상
- 영문과 숫자를 포함해야 함
- 애플리케이션 레벨에서 검증

### BR-003: 회원가입 후 역할 선택 필수
- 회원가입 완료 후 반드시 광고주 또는 인플루언서 역할을 선택해야 함
- User.role은 NULL 상태로 시작

### BR-004: 이메일 인증 (Phase 2)
- Phase 1에서는 이메일 인증 없이 즉시 로그인 가능
- Phase 2에서 이메일 인증 메일 발송 및 검증 추가 예정

## 8. UI/UX 요구사항

### 입력 필드
- 이메일: 텍스트 입력 (type="email")
- 비밀번호: 비밀번호 입력 (type="password")
- 비밀번호 확인: 비밀번호 입력 (type="password")

### 버튼
- "회원가입" 버튼 (Primary)
- "로그인 페이지로 이동" 링크

### 메시지
- 성공: "회원가입이 완료되었습니다"
- 에러: 각 검증 실패 시 구체적인 메시지 표시

## 9. 데이터 모델

### 입력 데이터
```json
{
  "email": "user@example.com",
  "password": "password123",
  "password_confirm": "password123"
}
```

### 출력 데이터 (성공 시)
```json
{
  "user_id": "uuid-v4",
  "email": "user@example.com",
  "role": null,
  "created_at": "2025-11-14T12:00:00Z"
}
```

## 10. 시퀀스 다이어그램

```
사용자 -> 회원가입 페이지: 접속
회원가입 페이지 -> 사용자: 입력 폼 표시
사용자 -> 회원가입 페이지: 정보 입력 및 제출
회원가입 페이지 -> WTForms: 입력 검증
WTForms --> 회원가입 페이지: 검증 성공
회원가입 페이지 -> Supabase Auth: 회원가입 요청
Supabase Auth --> 회원가입 페이지: 201 Created + 세션 토큰
회원가입 페이지 -> DB (User): User 레코드 생성
DB (User) --> 회원가입 페이지: 생성 완료
회원가입 페이지 -> 사용자: 역할 선택 페이지로 리다이렉트
```

## 11. 테스트 시나리오

### 11.1 정상 시나리오
- **Given**: 사용자가 회원가입 페이지에 접속
- **When**: 올바른 이메일과 비밀번호를 입력하고 제출
- **Then**: User 테이블에 레코드 생성, 역할 선택 페이지로 이동

### 11.2 이메일 중복
- **Given**: 이미 등록된 이메일 존재
- **When**: 동일한 이메일로 회원가입 시도
- **Then**: "이미 사용 중인 이메일입니다" 에러 메시지 표시

### 11.3 비밀번호 불일치
- **Given**: 사용자가 회원가입 페이지에 접속
- **When**: 비밀번호와 비밀번호 확인이 다름
- **Then**: "비밀번호가 일치하지 않습니다" 에러 메시지 표시

## 12. 참고 문서

- `docs/userflow.md`: 회원가입 플로우 (1.1)
- `docs/prd.md`: 회원가입 기능 요구사항 (6.1.1)
- `docs/database.md`: User 테이블 스키마 (3.1)
