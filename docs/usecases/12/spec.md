# UC-012: 체험단 상세 조회

## 1. 유스케이스 정보

| 항목 | 내용 |
|------|------|
| **유스케이스 ID** | UC-012 |
| **유스케이스 이름** | 체험단 상세 조회 |
| **액터** | 모든 사용자 (비로그인 포함) |
| **우선순위** | 높음 |
| **관련 기능** | 체험단 탐색 |

## 2. 사전조건 (Preconditions)

없음 (비로그인 사용자도 접근 가능)

## 3. 사후조건 (Postconditions)

### 성공 시
- 체험단 상세 정보 표시
- 사용자 권한에 따라 "지원하기" 버튼 표시 여부 결정

## 4. 주요 플로우 (Main Flow)

1. 사용자가 체험단 목록에서 특정 체험단 클릭 또는 URL 직접 접근
2. 체험단 상세 페이지(`/campaign/<campaign_id>`)로 이동
3. **시스템**: Campaign 조회
   - campaign_id로 Campaign 테이블 조회
   - JOIN Advertiser 테이블 (광고주 정보)
   - 체험단 없음: 404 페이지 표시
4. **시스템**: 체험단 정보 표시
   - 대표 이미지
   - 제목
   - 설명 (전체)
   - 모집 인원 / 현재 지원자 수
   - 모집 기간 (시작일 ~ 종료일)
   - 제공 혜택
   - 체험 조건
   - 광고주 정보 (업체명, 주소)
5. **시스템**: 지원 버튼 표시 여부 결정
   - **미로그인 시**: "로그인이 필요합니다" 메시지 + 로그인 버튼
   - **로그인 + 인플루언서 정보 미등록**: "인플루언서 정보를 먼저 등록해주세요" 메시지 + 정보 등록 버튼
   - **로그인 + 인플루언서 정보 등록 + 모집중**: "지원하기" 버튼 표시
   - **로그인 + 이미 지원함**: "지원완료" 비활성화 버튼 표시
   - **모집 종료**: "모집이 종료되었습니다" 메시지 표시
6. 사용자가 "지원하기" 버튼 클릭 시 체험단 지원 페이지로 이동

## 5. 대체 플로우 (Alternative Flows)

### 5.1 체험단 없음 (404)
- **시점**: 3단계 (Campaign 조회)
- **조건**: campaign_id로 Campaign 없음
- **처리**:
  - 404 페이지 표시
  - "존재하지 않는 체험단입니다" 메시지
  - 홈으로 돌아가기 버튼 제공

### 5.2 미로그인 사용자
- **시점**: 5단계 (지원 버튼 표시 결정)
- **조건**: 세션에 user_id 없음
- **처리**:
  - 체험단 정보는 표시
  - "로그인이 필요합니다" 메시지 표시
  - "로그인" 버튼 표시 → 로그인 페이지로 이동

### 5.3 로그인 + 인플루언서 정보 미등록
- **시점**: 5단계 (지원 버튼 표시 결정)
- **조건**: 로그인 상태지만 Influencer 레코드 없음
- **처리**:
  - 체험단 정보는 표시
  - "인플루언서 정보를 먼저 등록해주세요" 메시지 표시
  - "정보 등록하기" 버튼 표시 → 인플루언서 정보 등록 페이지로 이동

### 5.4 로그인 + 인플루언서 정보 등록 + 모집중
- **시점**: 5단계 (지원 버튼 표시 결정)
- **조건**: 로그인 + Influencer 레코드 존재 + Campaign.status = 'RECRUITING' + Application 없음
- **처리**:
  - "지원하기" 버튼 표시 (활성화)

### 5.5 로그인 + 이미 지원함
- **시점**: 5단계 (지원 버튼 표시 결정)
- **조건**: Application 테이블에 (campaign_id, influencer_id) 존재
- **처리**:
  - "지원완료" 버튼 표시 (비활성화)
  - 지원 상태 표시 (지원완료, 선정됨, 탈락)

### 5.6 모집 종료
- **시점**: 5단계 (지원 버튼 표시 결정)
- **조건**: Campaign.status = 'CLOSED' 또는 'SELECTED'
- **처리**:
  - "모집이 종료되었습니다" 메시지 표시
  - 지원 버튼 미표시

### 5.7 광고주 접근
- **시점**: 5단계 (지원 버튼 표시 결정)
- **조건**: 로그인 + User.role = 'advertiser'
- **처리**:
  - 체험단 정보는 표시
  - 지원 버튼 미표시
  - 본인 체험단인 경우: "관리하기" 버튼 표시 → 체험단 관리 페이지로 이동

## 6. 예외 플로우 (Exception Flows)

### 6.1 DB 조회 실패
- **조건**: Campaign 테이블 조회 실패
- **처리**:
  - "일시적인 오류가 발생했습니다" 메시지 표시

### 6.2 이미지 로딩 실패
- **조건**: Supabase Storage 이미지 로딩 실패
- **처리**:
  - 기본 이미지 표시
  - 로그 기록

## 7. 비즈니스 규칙 (Business Rules)

### BR-001: 비로그인 사용자도 조회 가능
- 체험단 상세 정보는 누구나 조회 가능
- 지원은 로그인 + 인플루언서 정보 등록 필요

### BR-002: 지원 버튼 표시 조건
- 로그인 + 인플루언서 정보 등록 + 모집중 + 미지원 상태

### BR-003: 이미 지원한 경우 재지원 불가
- Application 테이블에 (campaign_id, influencer_id) 존재 시 "지원완료" 비활성화 버튼 표시

### BR-004: 본인 체험단 관리 링크
- 광고주가 본인 체험단 조회 시 "관리하기" 버튼 표시

## 8. UI/UX 요구사항

### 체험단 정보 영역
- 대표 이미지 (상단, 큰 이미지)
- 제목 (Bold, 큰 글씨)
- 설명 (전체, 줄바꿈 유지)
- 모집 인원 / 지원자 수 (예: "5명 모집 / 12명 지원")
- 모집 기간 (예: "2025-11-15 ~ 2025-11-30")
- 제공 혜택 (구분된 섹션)
- 체험 조건 (구분된 섹션)
- 광고주 정보 (업체명, 주소)

### 지원 버튼 영역
- **미로그인**: "로그인이 필요합니다" 메시지 + "로그인" 버튼
- **인플루언서 정보 미등록**: "인플루언서 정보를 먼저 등록해주세요" 메시지 + "정보 등록하기" 버튼
- **지원 가능**: "지원하기" 버튼 (Primary, 활성화)
- **이미 지원함**: "지원완료" 버튼 (비활성화) + 지원 상태 표시
- **모집 종료**: "모집이 종료되었습니다" 메시지
- **본인 체험단 (광고주)**: "관리하기" 버튼

### 메시지
- "존재하지 않는 체험단입니다"
- "로그인이 필요합니다"
- "인플루언서 정보를 먼저 등록해주세요"
- "모집이 종료되었습니다"
- "일시적인 오류가 발생했습니다"

## 9. 데이터 모델

### 입력 데이터 (URL 파라미터)
```json
{
  "campaign_id": 1
}
```

### 출력 데이터 (성공 시)
```json
{
  "campaign": {
    "id": 1,
    "title": "신메뉴 파스타 체험단 모집",
    "description": "새로 출시한 파스타 메뉴를 체험하고 리뷰해주실 인플루언서를 모집합니다.",
    "quota": 5,
    "application_count": 12,
    "start_date": "2025-11-15",
    "end_date": "2025-11-30",
    "benefits": "무료 식사 제공",
    "conditions": "인스타그램 피드 1개 + 스토리 2개 업로드",
    "image_url": "https://...",
    "status": "RECRUITING",
    "advertiser": {
      "business_name": "테스트 카페",
      "address": "서울시 강남구 테헤란로 123"
    }
  },
  "user_application": {
    "has_applied": false,
    "status": null
  },
  "can_apply": true
}
```

## 10. 시퀀스 다이어그램

```
사용자 -> 체험단 목록: 체험단 카드 클릭
체험단 목록 -> 체험단 상세 페이지: 이동 (campaign_id)
체험단 상세 페이지 -> DB (Campaign): Campaign 조회 (JOIN Advertiser)
DB (Campaign) --> 체험단 상세 페이지: Campaign 정보 반환
체험단 상세 페이지 -> DB (Application): 지원자 수 조회 (COUNT)
DB (Application) --> 체험단 상세 페이지: 지원자 수 반환
체험단 상세 페이지 -> DB (Application): 사용자 지원 여부 조회 (선택, 로그인 시)
DB (Application) --> 체험단 상세 페이지: 지원 정보 반환
체험단 상세 페이지 -> 체험단 상세 페이지: 지원 버튼 표시 여부 결정
체험단 상세 페이지 -> 사용자: 체험단 정보 및 지원 버튼 표시
```

## 11. 테스트 시나리오

### 11.1 정상 조회 (비로그인)
- **Given**: 비로그인 사용자
- **When**: 체험단 상세 페이지 접근
- **Then**: 체험단 정보 표시, "로그인이 필요합니다" 메시지 + "로그인" 버튼

### 11.2 정상 조회 (인플루언서, 미지원)
- **Given**: 로그인된 인플루언서, 모집 중인 체험단
- **When**: 체험단 상세 페이지 접근
- **Then**: 체험단 정보 표시, "지원하기" 버튼 (활성화)

### 11.3 정상 조회 (인플루언서, 이미 지원)
- **Given**: 로그인된 인플루언서, 이미 지원한 체험단
- **When**: 체험단 상세 페이지 접근
- **Then**: 체험단 정보 표시, "지원완료" 버튼 (비활성화) + 지원 상태 표시

### 11.4 정상 조회 (광고주, 본인 체험단)
- **Given**: 로그인된 광고주, 본인 체험단
- **When**: 체험단 상세 페이지 접근
- **Then**: 체험단 정보 표시, "관리하기" 버튼

### 11.5 체험단 없음 (404)
- **Given**: 존재하지 않는 campaign_id
- **When**: 체험단 상세 페이지 접근
- **Then**: 404 페이지, "존재하지 않는 체험단입니다" 메시지

### 11.6 모집 종료된 체험단
- **Given**: 모집 종료된 체험단 (status = 'CLOSED')
- **When**: 체험단 상세 페이지 접근
- **Then**: 체험단 정보 표시, "모집이 종료되었습니다" 메시지

### 11.7 인플루언서 정보 미등록
- **Given**: 로그인 상태지만 인플루언서 정보 미등록
- **When**: 체험단 상세 페이지 접근
- **Then**: 체험단 정보 표시, "인플루언서 정보를 먼저 등록해주세요" 메시지 + "정보 등록하기" 버튼

## 12. 참고 문서

- `docs/userflow.md`: 체험단 상세 조회 플로우 (5.2)
- `docs/prd.md`: 체험단 상세 조회 기능 요구사항 (6.3.3)
- `docs/database.md`: Campaign 테이블 스키마 (3.4)
