# UC-003: 로그아웃

## 1. 유스케이스 정보

| 항목 | 내용 |
|------|------|
| **유스케이스 ID** | UC-003 |
| **유스케이스 이름** | 로그아웃 |
| **액터** | 로그인된 사용자 (광고주 또는 인플루언서) |
| **우선순위** | 중간 |
| **관련 기능** | 인증 |

## 2. 사전조건 (Preconditions)

- 사용자가 로그인 상태
- 유효한 세션이 존재

## 3. 사후조건 (Postconditions)

### 성공 시
- 서버 세션 삭제
- Supabase Auth 세션 종료
- 세션 쿠키 삭제
- 홈 페이지로 리다이렉트

## 4. 주요 플로우 (Main Flow)

1. 사용자가 네비게이션 바에서 "로그아웃" 버튼 클릭
2. **시스템**: 세션 삭제
   - Flask 서버 세션에서 사용자 정보 삭제
3. **시스템**: Supabase Auth 세션 종료
   - 액세스 토큰 무효화
   - 리프레시 토큰 무효화
4. **시스템**: 세션 쿠키 삭제
5. **시스템**: 홈 페이지(`/`)로 리다이렉트
6. **시스템**: "로그아웃되었습니다" 메시지 표시

## 5. 대체 플로우 (Alternative Flows)

해당 없음

## 6. 예외 플로우 (Exception Flows)

### 6.1 이미 로그아웃된 상태
- **조건**: 세션이 이미 만료되었거나 존재하지 않음
- **처리**:
  - 홈 페이지로 리다이렉트
  - 에러 메시지 없음

### 6.2 Supabase 세션 종료 실패
- **조건**: Supabase Auth 세션 종료 API 호출 실패
- **처리**:
  - 서버 세션은 삭제
  - 홈 페이지로 리다이렉트
  - 로그 기록

## 7. 비즈니스 규칙 (Business Rules)

### BR-001: 세션 완전 삭제
- 서버 세션과 클라이언트 쿠키 모두 삭제
- Supabase Auth 세션도 무효화

### BR-002: 로그아웃 후 접근 제한
- 로그아웃 후 인증이 필요한 페이지 접근 시 로그인 페이지로 리다이렉트

## 8. UI/UX 요구사항

### 버튼
- 네비게이션 바: "로그아웃" 버튼 (로그인 상태에서만 표시)

### 메시지
- 성공: "로그아웃되었습니다"

## 9. 데이터 모델

### 입력 데이터
없음 (버튼 클릭만)

### 출력 데이터
없음

## 10. 시퀀스 다이어그램

```
사용자 -> 네비게이션 바: "로그아웃" 버튼 클릭
네비게이션 바 -> Flask: 로그아웃 요청
Flask -> Flask Session: 세션 삭제
Flask Session --> Flask: 삭제 완료
Flask -> Supabase Auth: 세션 종료 요청
Supabase Auth --> Flask: 종료 완료
Flask -> 사용자: 쿠키 삭제 + 홈으로 리다이렉트
```

## 11. 테스트 시나리오

### 11.1 정상 로그아웃
- **Given**: 사용자가 로그인 상태
- **When**: "로그아웃" 버튼 클릭
- **Then**: 세션 삭제, 홈 페이지로 이동, "로그아웃되었습니다" 메시지 표시

### 11.2 이미 로그아웃된 상태
- **Given**: 세션이 만료된 사용자
- **When**: 로그아웃 URL 직접 접근
- **Then**: 홈 페이지로 리다이렉트

## 12. 참고 문서

- `docs/userflow.md`: 로그아웃 플로우 (7.1)
- `docs/prd.md`: 인증 기능 요구사항 (6.1)
