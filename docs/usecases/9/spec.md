# UC-009: 체험단 탐색

## 1. 유스케이스 정보

| 항목 | 내용 |
|------|------|
| **유스케이스 ID** | UC-009 |
| **유스케이스 이름** | 체험단 탐색 |
| **액터** | 모든 사용자 (비로그인 포함) |
| **우선순위** | 높음 |
| **관련 기능** | 체험단 탐색 |

## 2. 사전조건 (Preconditions)

없음 (비로그인 사용자도 접근 가능)

## 3. 사후조건 (Postconditions)

### 성공 시
- 모집 중인 체험단 목록 표시
- 검색/필터/정렬 조건에 맞는 결과 표시
- 페이지네이션 적용

## 4. 주요 플로우 (Main Flow)

1. 사용자가 홈 페이지(`/`)에 접속
2. **시스템**: Campaign 테이블 조회
   - status가 'RECRUITING'인 체험단 조회
   - 페이지네이션 적용 (한 페이지당 12개)
   - 정렬: created_at DESC (최신순, 기본값)
3. **시스템**: 각 체험단 정보 조회
   - Campaign 정보 (title, description, quota, end_date, image_url)
   - Advertiser 정보 (business_name) - JOIN
   - 지원자 수 (Application COUNT)
4. **시스템**: 체험단 카드 형식으로 표시
   - 대표 이미지
   - 제목
   - 간단한 설명 (최대 100자)
   - 모집 인원 / 현재 지원자 수
   - 모집 종료일 (D-day 형식)
   - 제공 혜택 (요약)
5. 사용자가 체험단 카드 클릭 시 체험단 상세 페이지(`/campaign/<campaign_id>`)로 이동

## 5. 대체 플로우 (Alternative Flows)

### 5.1 검색어 입력
- **시점**: 1단계 (홈 페이지 접속)
- **조건**: 사용자가 검색어 입력
- **처리**:
  - Campaign.title 또는 Campaign.description에서 검색어 포함 여부 확인 (LIKE 검색)
  - 검색 결과 표시

### 5.2 모집 상태 필터 적용
- **시점**: 1단계 (홈 페이지 접속)
- **조건**: 사용자가 모집 상태 필터 선택
- **처리**:
  - 모집 중만 표시 (기본값)
  - 모집 종료 포함 표시 (선택 시)

### 5.3 정렬 조건 변경
- **시점**: 1단계 (홈 페이지 접속)
- **조건**: 사용자가 정렬 조건 선택
- **처리**:
  - 최신순: created_at DESC (기본값)
  - 마감임박순: end_date ASC
  - 인기순: Application COUNT DESC (Phase 2)

### 5.4 페이지네이션
- **시점**: 5단계 (목록 표시 후)
- **조건**: 사용자가 다음/이전 페이지 클릭
- **처리**:
  - OFFSET 값 변경하여 다음/이전 페이지 데이터 조회
  - 페이지 번호 표시

### 5.5 체험단 없음
- **시점**: 2단계 (Campaign 조회)
- **조건**: 모집 중인 체험단이 없음
- **처리**:
  - "현재 모집 중인 체험단이 없습니다" 메시지 표시

### 5.6 검색 결과 없음
- **시점**: 5.1 (검색어 입력)
- **조건**: 검색 결과가 없음
- **처리**:
  - "검색 결과가 없습니다" 메시지 표시

## 6. 예외 플로우 (Exception Flows)

### 6.1 DB 조회 실패
- **조건**: Campaign 테이블 조회 실패
- **처리**:
  - "일시적인 오류가 발생했습니다" 메시지 표시

### 6.2 이미지 로딩 실패
- **조건**: Supabase Storage 이미지 로딩 실패
- **처리**:
  - 기본 이미지 표시
  - 로그 기록

## 7. 비즈니스 규칙 (Business Rules)

### BR-001: 모집 중인 체험단만 표시 (기본)
- Campaign.status = 'RECRUITING'인 체험단만 표시
- 사용자가 필터 변경 시 모집 종료 포함 가능

### BR-002: 페이지네이션
- 한 페이지당 12개 체험단 표시
- 성능 최적화를 위한 LIMIT/OFFSET 사용

### BR-003: 검색어 대소문자 구분 없음
- LIKE 검색 시 대소문자 구분 없음 (ILIKE 사용, PostgreSQL)

### BR-004: D-day 계산
- 모집 종료일 기준으로 D-day 계산
- D-day = end_date - 현재 날짜
- 예: "D-3", "D-day", "마감"

## 8. UI/UX 요구사항

### 검색/필터 영역
- 검색어 입력: 텍스트 입력
- 정렬 조건: 드롭다운 (최신순, 마감임박순, 인기순)
- 모집 상태: 체크박스 (모집 종료 포함)

### 체험단 카드
- 대표 이미지 (썸네일)
- 제목 (Bold, 최대 2줄)
- 간단한 설명 (최대 100자, 최대 3줄)
- 모집 인원 / 지원자 수 (예: "5명 / 12명 지원")
- 모집 종료일 (D-day 형식, 예: "D-3")
- 제공 혜택 (요약, 최대 50자)

### 페이지네이션
- 이전/다음 버튼
- 페이지 번호 표시 (최대 5개)

### 메시지
- "현재 모집 중인 체험단이 없습니다"
- "검색 결과가 없습니다"

## 9. 데이터 모델

### 입력 데이터 (쿼리 파라미터)
```json
{
  "search": "파스타",
  "sort": "latest" | "deadline" | "popular",
  "include_closed": false,
  "page": 1
}
```

### 출력 데이터 (성공 시)
```json
{
  "campaigns": [
    {
      "id": 1,
      "title": "신메뉴 파스타 체험단 모집",
      "description_summary": "새로 출시한 파스타 메뉴를 체험하고 리뷰해주실 인플루언서를 모집합니다.",
      "quota": 5,
      "application_count": 12,
      "end_date": "2025-11-30",
      "d_day": 3,
      "image_url": "https://...",
      "benefits_summary": "무료 식사 제공",
      "advertiser": {
        "business_name": "테스트 카페"
      }
    }
  ],
  "pagination": {
    "current_page": 1,
    "total_pages": 5,
    "total_count": 52,
    "has_next": true,
    "has_prev": false
  }
}
```

## 10. 시퀀스 다이어그램

```
사용자 -> 홈 페이지: 접속
홈 페이지 -> DB (Campaign): Campaign 조회 (status=RECRUITING, LIMIT 12)
DB (Campaign) -> DB (Advertiser): Advertiser JOIN
DB (Advertiser) --> DB (Campaign): Advertiser 정보 반환
DB (Campaign) -> DB (Application): Application COUNT
DB (Application) --> DB (Campaign): 지원자 수 반환
DB (Campaign) --> 홈 페이지: Campaign 목록 반환
홈 페이지 -> 사용자: 체험단 카드 목록 표시
사용자 -> 홈 페이지: 체험단 카드 클릭
홈 페이지 -> 사용자: 체험단 상세 페이지로 이동
```

## 11. 테스트 시나리오

### 11.1 정상 조회 (기본)
- **Given**: 모집 중인 체험단 20개 존재
- **When**: 홈 페이지 접속
- **Then**: 최신순으로 12개 체험단 카드 표시, 페이지네이션 표시

### 11.2 검색어 입력
- **Given**: 홈 페이지 접속
- **When**: "파스타" 검색어 입력
- **Then**: 제목 또는 설명에 "파스타" 포함된 체험단만 표시

### 11.3 마감임박순 정렬
- **Given**: 홈 페이지 접속
- **When**: 정렬 조건을 "마감임박순" 선택
- **Then**: end_date가 가까운 순서대로 체험단 표시

### 11.4 체험단 없음
- **Given**: 모집 중인 체험단이 없음
- **When**: 홈 페이지 접속
- **Then**: "현재 모집 중인 체험단이 없습니다" 메시지 표시

### 11.5 검색 결과 없음
- **Given**: 홈 페이지 접속
- **When**: 존재하지 않는 검색어 입력
- **Then**: "검색 결과가 없습니다" 메시지 표시

### 11.6 페이지네이션
- **Given**: 모집 중인 체험단 25개 존재
- **When**: 홈 페이지 접속 후 "다음 페이지" 클릭
- **Then**: 13~24번째 체험단 표시

## 12. 참고 문서

- `docs/userflow.md`: 체험단 탐색 플로우 (5.1)
- `docs/prd.md`: 체험단 목록 조회 기능 요구사항 (6.3.2)
- `docs/database.md`: Campaign 테이블 스키마 (3.4)
