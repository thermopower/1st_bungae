{% extends "base.html" %}

{% block title %}내 지원 내역 - 1st Bungae{% endblock %}

{% block extra_css %}
<style>
.filter-buttons .btn-group {
    flex-wrap: wrap;
}
.filter-button {
    white-space: nowrap;
}
.filter-button .badge {
    margin-left: 0.25rem;
}
.application-card {
    transition: box-shadow 0.3s ease;
}
.application-card:hover {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}
.empty-state {
    padding: 3rem 1rem;
}
.empty-state i {
    font-size: 4rem;
    color: #dee2e6;
}
.sort-controls {
    display: flex;
    justify-content: flex-end;
    align-items: center;
}
.sort-controls .btn {
    font-size: 0.875rem;
}
</style>
{% endblock %}

{% block content %}
<div class="container my-5">
  <!-- 페이지 헤더 -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1>내 지원 내역</h1>
    <a href="{{ url_for('main.home') }}" class="btn btn-outline-primary">
      <i class="bi bi-house"></i> 홈으로
    </a>
  </div>

  <!-- 상태별 필터 버튼 -->
  <div class="filter-buttons mb-4">
    <div class="btn-group" role="group" aria-label="상태 필터">
      <button type="button" class="btn btn-primary filter-button" data-filter="all">
        전체 <span class="badge bg-white text-primary">{{ total_count }}</span>
      </button>
      <button type="button" class="btn btn-outline-primary filter-button" data-filter="applied">
        지원완료 <span class="badge bg-primary">{{ status_counts.applied }}</span>
      </button>
      <button type="button" class="btn btn-outline-primary filter-button" data-filter="selected">
        선정됨 <span class="badge bg-success">{{ status_counts.selected }}</span>
      </button>
      <button type="button" class="btn btn-outline-primary filter-button" data-filter="rejected">
        탈락 <span class="badge bg-secondary">{{ status_counts.rejected }}</span>
      </button>
    </div>
  </div>

  <!-- 정렬 버튼 -->
  <div class="sort-controls mb-3">
    <button id="sort-button" class="btn btn-outline-secondary btn-sm">
      <i class="bi bi-sort-down"></i> 최신순
    </button>
  </div>

  <!-- 지원 내역 목록 -->
  <div id="application-list">
    {% if applications %}
      {% for app in applications %}
        <div class="application-card card mb-3" data-status="{{ app.status | lower }}" data-id="{{ app.id }}">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start">
              <div class="flex-grow-1">
                <h5 class="card-title">{{ app.campaign.title }}</h5>
                <p class="card-text mb-2">
                  <span class="badge bg-{{ app.status_badge_color }}">{{ app.status_text }}</span>
                </p>
                <p class="text-muted small mb-0">
                  <i class="bi bi-building"></i> {{ app.advertiser.business_name }}<br>
                  <i class="bi bi-calendar"></i> 지원일: {{ app.applied_at.strftime('%Y-%m-%d %H:%M') }}
                </p>
              </div>
              <div>
                <a href="{{ url_for('campaign.detail', campaign_id=app.campaign.id) }}"
                   class="btn btn-primary btn-sm">
                  상세보기 <i class="bi bi-arrow-right"></i>
                </a>
              </div>
            </div>
          </div>
        </div>
      {% endfor %}
    {% else %}
      <div class="empty-state text-center" id="empty-state">
        <i class="bi bi-inbox"></i>
        <h4 class="mt-3">아직 지원한 체험단이 없습니다</h4>
        <p class="text-muted">관심 있는 체험단에 지원해보세요!</p>
        <a href="{{ url_for('main.home') }}" class="btn btn-primary mt-3">
          <i class="bi bi-search"></i> 체험단 탐색하기
        </a>
      </div>
    {% endif %}
  </div>
</div>

<!-- 데이터 주입 (Vanilla JS에서 사용) -->
<script id="applications-data" type="application/json">
  {{ applications_json | safe }}
</script>

<script src="{{ url_for('static', filename='js/applications.js') }}"></script>
{% endblock %}
